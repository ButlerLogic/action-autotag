{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/normalize-paginated-list-response.js","../dist-src/iterator.js","../dist-src/paginate.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"1.1.1\";\n","/**\n * Some “list” response that can be paginated have a different response structure\n *\n * They have a `total_count` key in the response (search also has `incomplete_results`,\n * /installation/repositories also has `repository_selection`), as well as a key with\n * the list of the items which name varies from endpoint to endpoint:\n *\n * - https://developer.github.com/v3/search/#example (key `items`)\n * - https://developer.github.com/v3/checks/runs/#response-3 (key: `check_runs`)\n * - https://developer.github.com/v3/checks/suites/#response-1 (key: `check_suites`)\n * - https://developer.github.com/v3/apps/installations/#list-repositories (key: `repositories`)\n * - https://developer.github.com/v3/apps/installations/#list-installations-for-a-user (key `installations`)\n *\n * Octokit normalizes these responses so that paginated results are always returned following\n * the same structure. One challenge is that if the list response has only one page, no Link\n * header is provided, so this header alone is not sufficient to check wether a response is\n * paginated or not. For the exceptions with the namespace, a fallback check for the route\n * paths has to be added in order to normalize the response. We cannot check for the total_count\n * property because it also exists in the response of Get the combined status for a specific ref.\n */\nconst REGEX_IS_SEARCH_PATH = /^\\/search\\//;\nconst REGEX_IS_CHECKS_PATH = /^\\/repos\\/[^/]+\\/[^/]+\\/commits\\/[^/]+\\/(check-runs|check-suites)/;\nconst REGEX_IS_INSTALLATION_REPOSITORIES_PATH = /^\\/installation\\/repositories/;\nconst REGEX_IS_USER_INSTALLATIONS_PATH = /^\\/user\\/installations/;\nexport function normalizePaginatedListResponse(octokit, url, response) {\n    const path = url.replace(octokit.request.endpoint.DEFAULTS.baseUrl, \"\");\n    if (!REGEX_IS_SEARCH_PATH.test(path) &&\n        !REGEX_IS_CHECKS_PATH.test(path) &&\n        !REGEX_IS_INSTALLATION_REPOSITORIES_PATH.test(path) &&\n        !REGEX_IS_USER_INSTALLATIONS_PATH.test(path)) {\n        return;\n    }\n    // keep the additional properties intact as there is currently no other way\n    // to retrieve the same information.\n    const incompleteResults = response.data.incomplete_results;\n    const repositorySelection = response.data.repository_selection;\n    const totalCount = response.data.total_count;\n    delete response.data.incomplete_results;\n    delete response.data.repository_selection;\n    delete response.data.total_count;\n    const namespaceKey = Object.keys(response.data)[0];\n    const data = response.data[namespaceKey];\n    response.data = data;\n    if (typeof incompleteResults !== \"undefined\") {\n        response.data.incomplete_results = incompleteResults;\n    }\n    if (typeof repositorySelection !== \"undefined\") {\n        response.data.repository_selection = repositorySelection;\n    }\n    response.data.total_count = totalCount;\n    Object.defineProperty(response.data, namespaceKey, {\n        get() {\n            octokit.log.warn(`[@octokit/paginate-rest] \"response.data.${namespaceKey}\" is deprecated for \"GET ${path}\". Get the results directly from \"response.data\"`);\n            return Array.from(data);\n        }\n    });\n}\n","import { normalizePaginatedListResponse } from \"./normalize-paginated-list-response\";\nexport function iterator(octokit, route, parameters) {\n    const options = octokit.request.endpoint(route, parameters);\n    const method = options.method;\n    const headers = options.headers;\n    let url = options.url;\n    return {\n        [Symbol.asyncIterator]: () => ({\n            next() {\n                if (!url) {\n                    return Promise.resolve({ done: true });\n                }\n                return octokit\n                    .request({ method, url, headers })\n                    .then((response) => {\n                    normalizePaginatedListResponse(octokit, url, response);\n                    // `response.headers.link` format:\n                    // '<https://api.github.com/users/aseemk/followers?page=2>; rel=\"next\", <https://api.github.com/users/aseemk/followers?page=2>; rel=\"last\"'\n                    // sets `url` to undefined if \"next\" URL is not present or `link` header is not set\n                    url = ((response.headers.link || \"\").match(/<([^>]+)>;\\s*rel=\"next\"/) || [])[1];\n                    return { value: response };\n                });\n            }\n        })\n    };\n}\n","import { iterator } from \"./iterator\";\nexport function paginate(octokit, route, parameters, mapFn) {\n    if (typeof parameters === \"function\") {\n        mapFn = parameters;\n        parameters = undefined;\n    }\n    return gather(octokit, [], iterator(octokit, route, parameters)[Symbol.asyncIterator](), mapFn);\n}\nfunction gather(octokit, results, iterator, mapFn) {\n    return iterator.next().then(result => {\n        if (result.done) {\n            return results;\n        }\n        let earlyExit = false;\n        function done() {\n            earlyExit = true;\n        }\n        results = results.concat(mapFn ? mapFn(result.value, done) : result.value.data);\n        if (earlyExit) {\n            return results;\n        }\n        return gather(octokit, results, iterator, mapFn);\n    });\n}\n","import { VERSION } from \"./version\";\nimport { paginate } from \"./paginate\";\nimport { iterator } from \"./iterator\";\n/**\n * @param octokit Octokit instance\n * @param options Options passed to Octokit constructor\n */\nexport function paginateRest(octokit) {\n    return {\n        paginate: Object.assign(paginate.bind(null, octokit), {\n            iterator: iterator.bind(null, octokit)\n        })\n    };\n}\npaginateRest.VERSION = VERSION;\n"],"names":["VERSION","REGEX_IS_SEARCH_PATH","REGEX_IS_CHECKS_PATH","REGEX_IS_INSTALLATION_REPOSITORIES_PATH","REGEX_IS_USER_INSTALLATIONS_PATH","normalizePaginatedListResponse","octokit","url","response","path","replace","request","endpoint","DEFAULTS","baseUrl","test","incompleteResults","data","incomplete_results","repositorySelection","repository_selection","totalCount","total_count","namespaceKey","Object","keys","defineProperty","get","log","warn","Array","from","iterator","route","parameters","options","method","headers","Symbol","asyncIterator","next","Promise","resolve","done","then","link","match","value","paginate","mapFn","undefined","gather","results","result","earlyExit","concat","paginateRest","assign","bind"],"mappings":"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"}