{
  "version": 3,
  "sources": ["../dist-src/index.js", "../dist-src/version.js", "../dist-src/webhooks.js", "../dist-src/each-installation.js", "../dist-src/get-installation-octokit.js", "../dist-src/each-repository.js", "../dist-src/middleware/node/index.js", "../dist-src/middleware/node/on-unhandled-request-default.js"],
  "sourcesContent": ["import { Octokit as OctokitCore } from \"@octokit/core\";\nimport { createAppAuth } from \"@octokit/auth-app\";\nimport { OAuthApp } from \"@octokit/oauth-app\";\nimport { Webhooks } from \"@octokit/webhooks\";\nimport { VERSION } from \"./version\";\nimport { webhooks } from \"./webhooks\";\nimport { eachInstallationFactory } from \"./each-installation\";\nimport { eachRepositoryFactory } from \"./each-repository\";\nimport { getInstallationOctokit } from \"./get-installation-octokit\";\nclass App {\n  static defaults(defaults) {\n    const AppWithDefaults = class extends this {\n      constructor(...args) {\n        super({\n          ...defaults,\n          ...args[0]\n        });\n      }\n    };\n    return AppWithDefaults;\n  }\n  constructor(options) {\n    const Octokit = options.Octokit || OctokitCore;\n    const authOptions = Object.assign(\n      {\n        appId: options.appId,\n        privateKey: options.privateKey\n      },\n      options.oauth ? {\n        clientId: options.oauth.clientId,\n        clientSecret: options.oauth.clientSecret\n      } : {}\n    );\n    this.octokit = new Octokit({\n      authStrategy: createAppAuth,\n      auth: authOptions,\n      log: options.log\n    });\n    this.log = Object.assign(\n      {\n        debug: () => {\n        },\n        info: () => {\n        },\n        warn: console.warn.bind(console),\n        error: console.error.bind(console)\n      },\n      options.log\n    );\n    if (options.webhooks) {\n      this.webhooks = webhooks(this.octokit, options.webhooks);\n    } else {\n      Object.defineProperty(this, \"webhooks\", {\n        get() {\n          throw new Error(\"[@octokit/app] webhooks option not set\");\n        }\n      });\n    }\n    if (options.oauth) {\n      this.oauth = new OAuthApp({\n        ...options.oauth,\n        clientType: \"github-app\",\n        Octokit\n      });\n    } else {\n      Object.defineProperty(this, \"oauth\", {\n        get() {\n          throw new Error(\n            \"[@octokit/app] oauth.clientId / oauth.clientSecret options are not set\"\n          );\n        }\n      });\n    }\n    this.getInstallationOctokit = getInstallationOctokit.bind(\n      null,\n      this\n    );\n    this.eachInstallation = eachInstallationFactory(\n      this\n    );\n    this.eachRepository = eachRepositoryFactory(\n      this\n    );\n  }\n}\nApp.VERSION = VERSION;\nimport { createNodeMiddleware } from \"./middleware/node/index\";\nexport {\n  App,\n  createNodeMiddleware\n};\n", "const VERSION = \"13.1.8\";\nexport {\n  VERSION\n};\n", "import { Octokit } from \"@octokit/core\";\nimport { createAppAuth } from \"@octokit/auth-app\";\nimport { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nimport { Webhooks } from \"@octokit/webhooks\";\nfunction webhooks(appOctokit, options) {\n  return new Webhooks({\n    secret: options.secret,\n    transform: async (event) => {\n      if (!(\"installation\" in event.payload) || typeof event.payload.installation !== \"object\") {\n        const octokit2 = new appOctokit.constructor({\n          authStrategy: createUnauthenticatedAuth,\n          auth: {\n            reason: `\"installation\" key missing in webhook event payload`\n          }\n        });\n        return {\n          ...event,\n          octokit: octokit2\n        };\n      }\n      const installationId = event.payload.installation.id;\n      const octokit = await appOctokit.auth({\n        type: \"installation\",\n        installationId,\n        factory(auth) {\n          return new auth.octokit.constructor({\n            ...auth.octokitOptions,\n            authStrategy: createAppAuth,\n            ...{\n              auth: {\n                ...auth,\n                installationId\n              }\n            }\n          });\n        }\n      });\n      octokit.hook.before(\"request\", (options2) => {\n        options2.headers[\"x-github-delivery\"] = event.id;\n      });\n      return {\n        ...event,\n        octokit\n      };\n    }\n  });\n}\nexport {\n  webhooks\n};\n", "import { composePaginateRest } from \"@octokit/plugin-paginate-rest\";\nimport { Octokit } from \"@octokit/core\";\nimport { App } from \"./index\";\nimport { getInstallationOctokit } from \"./get-installation-octokit\";\nfunction eachInstallationFactory(app) {\n  return Object.assign(eachInstallation.bind(null, app), {\n    iterator: eachInstallationIterator.bind(null, app)\n  });\n}\nasync function eachInstallation(app, callback) {\n  const i = eachInstallationIterator(app)[Symbol.asyncIterator]();\n  let result = await i.next();\n  while (!result.done) {\n    await callback(result.value);\n    result = await i.next();\n  }\n}\nfunction eachInstallationIterator(app) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      const iterator = composePaginateRest.iterator(\n        app.octokit,\n        \"GET /app/installations\"\n      );\n      for await (const { data: installations } of iterator) {\n        for (const installation of installations) {\n          const installationOctokit = await getInstallationOctokit(\n            app,\n            installation.id\n          );\n          yield { octokit: installationOctokit, installation };\n        }\n      }\n    }\n  };\n}\nexport {\n  eachInstallation,\n  eachInstallationFactory,\n  eachInstallationIterator\n};\n", "import { createAppAuth } from \"@octokit/auth-app\";\nimport { Octokit } from \"@octokit/core\";\nimport { App } from \"./index\";\nasync function getInstallationOctokit(app, installationId) {\n  return app.octokit.auth({\n    type: \"installation\",\n    installationId,\n    factory(auth) {\n      const options = {\n        ...auth.octokitOptions,\n        authStrategy: createAppAuth,\n        ...{ auth: { ...auth, installationId } }\n      };\n      return new auth.octokit.constructor(options);\n    }\n  });\n}\nexport {\n  getInstallationOctokit\n};\n", "import { composePaginateRest } from \"@octokit/plugin-paginate-rest\";\nimport { Octokit } from \"@octokit/core\";\nimport { App } from \"./index\";\nfunction eachRepositoryFactory(app) {\n  return Object.assign(eachRepository.bind(null, app), {\n    iterator: eachRepositoryIterator.bind(null, app)\n  });\n}\nasync function eachRepository(app, queryOrCallback, callback) {\n  const i = eachRepositoryIterator(\n    app,\n    callback ? queryOrCallback : void 0\n  )[Symbol.asyncIterator]();\n  let result = await i.next();\n  while (!result.done) {\n    if (callback) {\n      await callback(result.value);\n    } else {\n      await queryOrCallback(result.value);\n    }\n    result = await i.next();\n  }\n}\nfunction singleInstallationIterator(app, installationId) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      yield {\n        octokit: await app.getInstallationOctokit(installationId)\n      };\n    }\n  };\n}\nfunction eachRepositoryIterator(app, query) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      const iterator = query ? singleInstallationIterator(app, query.installationId) : app.eachInstallation.iterator();\n      for await (const { octokit } of iterator) {\n        const repositoriesIterator = composePaginateRest.iterator(\n          octokit,\n          \"GET /installation/repositories\"\n        );\n        for await (const { data: repositories } of repositoriesIterator) {\n          for (const repository of repositories) {\n            yield { octokit, repository };\n          }\n        }\n      }\n    }\n  };\n}\nexport {\n  eachRepository,\n  eachRepositoryFactory,\n  eachRepositoryIterator\n};\n", "import { createNodeMiddleware as oauthNodeMiddleware } from \"@octokit/oauth-app\";\nimport { createNodeMiddleware as webhooksNodeMiddleware } from \"@octokit/webhooks\";\nimport { App } from \"../../index\";\nimport { onUnhandledRequestDefault } from \"./on-unhandled-request-default\";\nfunction noop() {\n}\nfunction createNodeMiddleware(app, options = {}) {\n  const log = Object.assign(\n    {\n      debug: noop,\n      info: noop,\n      warn: console.warn.bind(console),\n      error: console.error.bind(console)\n    },\n    options.log\n  );\n  const optionsWithDefaults = {\n    onUnhandledRequest: onUnhandledRequestDefault,\n    pathPrefix: \"/api/github\",\n    ...options,\n    log\n  };\n  const webhooksMiddleware = webhooksNodeMiddleware(app.webhooks, {\n    path: optionsWithDefaults.pathPrefix + \"/webhooks\",\n    log,\n    onUnhandledRequest: optionsWithDefaults.onUnhandledRequest\n  });\n  const oauthMiddleware = oauthNodeMiddleware(app.oauth, {\n    pathPrefix: optionsWithDefaults.pathPrefix + \"/oauth\",\n    onUnhandledRequest: optionsWithDefaults.onUnhandledRequest\n  });\n  return middleware.bind(null, optionsWithDefaults, {\n    webhooksMiddleware,\n    oauthMiddleware\n  });\n}\nasync function middleware(options, { webhooksMiddleware, oauthMiddleware }, request, response, next) {\n  const { pathname } = new URL(request.url, \"http://localhost\");\n  if (pathname === `${options.pathPrefix}/webhooks`) {\n    return webhooksMiddleware(request, response, next);\n  }\n  if (pathname.startsWith(`${options.pathPrefix}/oauth/`)) {\n    return oauthMiddleware(request, response, next);\n  }\n  const isExpressMiddleware = typeof next === \"function\";\n  if (isExpressMiddleware) {\n    return next();\n  }\n  return options.onUnhandledRequest(request, response);\n}\nexport {\n  createNodeMiddleware,\n  middleware\n};\n", "function onUnhandledRequestDefault(request, response) {\n  response.writeHead(404, {\n    \"content-type\": \"application/json\"\n  });\n  response.end(\n    JSON.stringify({\n      error: `Unknown route: ${request.method} ${request.url}`\n    })\n  );\n}\nexport {\n  onUnhandledRequestDefault\n};\n"],
  "mappings": "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",
  "names": ["import_core", "import_auth_app", "import_oauth_app", "import_webhooks", "import_core", "import_auth_app", "import_core", "import_plugin_paginate_rest", "import_core", "import_webhooks", "webhooksNodeMiddleware", "oauthNodeMiddleware", "Octokit", "OctokitCore"]
}
