{"version":3,"file":"index.js","sources":["../dist-src/error-request.js","../dist-src/wrap-request.js","../dist-src/index.js"],"sourcesContent":["// @ts-ignore\nexport async function errorRequest(state, octokit, error, options) {\n    if (!error.request || !error.request.request) {\n        // address https://github.com/octokit/plugin-retry.js/issues/8\n        throw error;\n    }\n    // retry all >= 400 && not doNotRetry\n    if (error.status >= 400 && !state.doNotRetry.includes(error.status)) {\n        const retries = options.request.retries != null ? options.request.retries : state.retries;\n        const retryAfter = Math.pow((options.request.retryCount || 0) + 1, 2);\n        throw octokit.retry.retryRequest(error, retries, retryAfter);\n    }\n    // Maybe eventually there will be more cases here\n    throw error;\n}\n","// @ts-nocheck\nimport Bottleneck from \"bottleneck/light\";\nimport { RequestError } from \"@octokit/request-error\";\nimport { errorRequest } from \"./error-request\";\nexport async function wrapRequest(state, octokit, request, options) {\n    const limiter = new Bottleneck();\n    limiter.on(\"failed\", function (error, info) {\n        const maxRetries = ~~error.request.request.retries;\n        const after = ~~error.request.request.retryAfter;\n        options.request.retryCount = info.retryCount + 1;\n        if (maxRetries > info.retryCount) {\n            // Returning a number instructs the limiter to retry\n            // the request after that number of milliseconds have passed\n            return after * state.retryAfterBaseValue;\n        }\n    });\n    return limiter.schedule(requestWithGraphqlErrorHandling.bind(null, state, octokit, request), options);\n}\nasync function requestWithGraphqlErrorHandling(state, octokit, request, options) {\n    const response = await request(request, options);\n    if (response.data &&\n        response.data.errors &&\n        /Something went wrong while executing your query/.test(response.data.errors[0].message)) {\n        // simulate 500 request error for retry handling\n        const error = new RequestError(response.data.errors[0].message, 500, {\n            request: options,\n            response,\n        });\n        return errorRequest(state, octokit, error, options);\n    }\n    return response;\n}\n","import { errorRequest } from \"./error-request\";\nimport { wrapRequest } from \"./wrap-request\";\nexport const VERSION = \"4.1.3\";\nexport function retry(octokit, octokitOptions) {\n    const state = Object.assign({\n        enabled: true,\n        retryAfterBaseValue: 1000,\n        doNotRetry: [400, 401, 403, 404, 422],\n        retries: 3,\n    }, octokitOptions.retry);\n    if (state.enabled) {\n        octokit.hook.error(\"request\", errorRequest.bind(null, state, octokit));\n        octokit.hook.wrap(\"request\", wrapRequest.bind(null, state, octokit));\n    }\n    return {\n        retry: {\n            retryRequest: (error, retries, retryAfter) => {\n                error.request.request = Object.assign({}, error.request.request, {\n                    retries: retries,\n                    retryAfter: retryAfter,\n                });\n                return error;\n            },\n        },\n    };\n}\nretry.VERSION = VERSION;\n"],"names":["errorRequest","state","octokit","error","options","request","status","doNotRetry","includes","retries","retryAfter","Math","pow","retryCount","retry","retryRequest","wrapRequest","limiter","Bottleneck","on","info","maxRetries","after","retryAfterBaseValue","schedule","requestWithGraphqlErrorHandling","bind","response","data","errors","test","message","RequestError","VERSION","octokitOptions","Object","assign","enabled","hook","wrap"],"mappings":"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"}